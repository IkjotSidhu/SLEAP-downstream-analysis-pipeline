# SLEAP Analysis Pipeline

[![Python 3.7+](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

A comprehensive Python pipeline for analyzing animal tracking data generated by [SLEAP](https://sleap.ai/) (Social LEAP Estimates Animal Poses).

## 🔥 Features

- **📊 Data Loading & Preprocessing**: Load HDF5 files from SLEAP with automatic missing data interpolation
- **🎯 Trajectory Analysis**: Plot spatial trajectories and time-series position data
- **📏 Inter-Animal Distance**: Calculate and visualize distances between tracked animals
- **⚡ Velocity Analysis**: Compute smoothed velocity profiles using Savitzky-Golay filtering
- **📈 Movement Statistics**: Analyze cumulative distance traveled over time
- **🔧 Modular Design**: Easy to extend with additional analyses
- **🎨 Publication-Ready Plots**: High-quality visualizations with consistent styling

## 📦 Installation

### Prerequisites
- Python 3.7 or higher
- SLEAP installation (see [SLEAP documentation](https://sleap.ai/installation.html))

### Setup

1. **Clone the repository:**
```bash
git clone https://github.com/yourusername/sleap-analysis-pipeline.git
cd sleap-analysis-pipeline
```

2. **Install dependencies:**
```bash
pip install -r requirements.txt
```

Or using conda:
```bash
conda install numpy scipy matplotlib seaborn h5py
pip install sleap
```

## 🚀 Quick Start

### Basic Usage

```python
from sleap_plotting import plotting_SLEAP, AnalysisConfig

# Run complete analysis pipeline
results = plotting_SLEAP(
    file_path="your_sleap_data.h5",
    main_node="bodycenter",  # Choose your node of interest
    fps=30,
    output_dir="./analysis_results"
)

print("Analysis complete!")
print(f"Analyzed {len(results['node_names'])} nodes")
print(f"Missing data: {results['summary']['missing_data_percentage']:.2f}%")
```

### Advanced Configuration

```python
from sleap_plotting import *

# Customize analysis parameters
config = AnalysisConfig()
config.update(
    fps=25,                     # Frame rate
    velocity_window=15,         # Smoothing window
    velocity_poly_order=3,      # Polynomial order
    figure_format='png',        # Output format
    colormap='viridis'          # Color scheme
)

# Run analysis with custom config
results = plotting_SLEAP(
    file_path="data.h5",
    main_node="bodycenter",
    fps=config.fps,
    output_dir="./custom_analysis"
)
```

### Individual Analysis Functions

```python
# Load data first
locations, node_names, frame_count, node_count, instance_count = load_sleap_data("data.h5")

# Run specific analyses
plot_node_trajectories(locations, node_index=0, node_name="bodycenter")
distances = analyze_inter_mouse_distance(locations, node_index=0, node_name="bodycenter")
velocities = analyze_velocities(locations, node_index=0, node_name="bodycenter")
analyze_cumulative_distance(locations, node_index=0, node_name="bodycenter")
```

## 📁 Repository Structure

```
sleap-analysis-pipeline/
├── sleap_plotting.py          # Main analysis pipeline
├── requirements.txt           # Python dependencies  
├── README.md                 # This file
├── .gitignore               # Git ignore rules
├── examples/                # Example scripts and data
│   ├── example_analysis.py  # Complete example
│   └── sample_config.py     # Configuration examples
├── docs/                    # Documentation
│   ├── API.md              # API reference
│   └── examples.md         # Usage examples
└── tests/                   # Unit tests
    ├── test_pipeline.py    # Pipeline tests
    └── test_utils.py       # Utility tests
```

## 📊 Output Files

The pipeline generates several types of visualizations saved as PDF files:

| File | Description |
|------|-------------|
| `{node}_locations.pdf` | Time-series position plots |
| `{node}_Node-Mouse-Tracking-plot.pdf` | Spatial trajectory plots |
| `{node}_Inter-Mouse-Distance-by-Frame.pdf` | Distance plots by frame |
| `{node}_Inter-Mouse-Distance-by-second.pdf` | Distance plots by time |
| `Mouse-1-{node}-velocity-plot.pdf` | Velocity analysis for animal 1 |
| `Mouse-2-{node}-velocity-plot.pdf` | Velocity analysis for animal 2 |
| `Cumulative-distance-over-time-{node}.pdf` | Cumulative movement analysis |

## 🔧 Configuration Options

The `AnalysisConfig` class provides easy customization:

```python
config = AnalysisConfig()
config.fps = 25                      # Frame rate (Hz)
config.velocity_window = 15          # Smoothing window size  
config.velocity_poly_order = 3       # Polynomial order for smoothing
config.velocity_vmin = 0             # Velocity plot minimum
config.velocity_vmax = 20            # Velocity plot maximum
config.figure_format = 'png'         # Output format ('pdf', 'png', 'svg')
config.figure_dpi = 300              # Figure resolution
config.colormap = 'viridis'          # Matplotlib colormap
```

## 📋 Data Requirements

The pipeline expects HDF5 files from SLEAP with:
- `tracks`: 4D array of shape `(frames, nodes, coordinates, instances)`
- `node_names`: List of node/keypoint names

## 🎯 Best Practices

### Data Preparation
- Ensure SLEAP predictions are of good quality before analysis
- Choose stable, well-tracked nodes (e.g., "bodycenter", "centroid") as primary nodes
- Verify frame rate settings match your video data

### Analysis Tips
- Use appropriate velocity smoothing windows (15-50 frames typical)
- Check missing data percentage before analysis
- Save intermediate results for large datasets

### Troubleshooting
- **Import Errors**: Verify all dependencies are installed
- **File Not Found**: Check file paths and HDF5 file accessibility  
- **Node Not Found**: Confirm node names match your SLEAP model
- **Memory Issues**: Consider analyzing shorter segments for large datasets

## 🧪 Testing

Run the test suite to verify installation:

```bash
python -m pytest tests/
```

## 🤝 Contributing

Contributions are welcome! Here are ways to extend the pipeline:

- **New Analysis Methods**: Angular velocity, social behavior metrics
- **Statistical Tests**: Behavioral comparisons, significance testing  
- **Interactive Visualizations**: Plotly/Bokeh integration
- **Batch Processing**: Multi-file analysis workflows
- **Export Formats**: CSV/Excel data export

### Development Setup

1. Fork the repository
2. Create a feature branch: `git checkout -b feature-name`
3. Make changes and add tests
4. Submit a pull request

## 📜 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 📚 Citation

If you use this pipeline in your research, please cite:

```bibtex
@software{sleap_analysis_pipeline,
  title={SLEAP Analysis Pipeline},
  author=Ikjot Sidhu,
  year={2025},
  url={https://github.com/yourusername/sleap-analysis-pipeline}
}
```

## 🙏 Acknowledgments

- [SLEAP Team](https://sleap.ai/) for the excellent pose estimation framework
- Scientific Python community for the foundational libraries
- Contributors and users who provide feedback and improvements

## 🐛 Issues & Support

- **Bug Reports**: [GitHub Issues](https://github.com/yourusername/sleap-analysis-pipeline/issues)
- **Feature Requests**: [GitHub Discussions](https://github.com/yourusername/sleap-analysis-pipeline/discussions)
- **Documentation**: Check the [docs/](docs/) folder for detailed guides

---

**⭐ Star this repository if you find it helpful!**
